<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Play The Internet</title>
	<link rel="stylesheet" href="jqC/development-bundle/themes/base/jquery.ui.all.css">
	<script src="jqC/development-bundle/jquery-1.7.1.js"></script>
	<script src="jqC/development-bundle/ui/jquery.ui.core.js"></script>
	<script src="jqC/development-bundle/ui/jquery.ui.widget.js"></script>
	<script src="jqC/development-bundle/ui/jquery.ui.mouse.js"></script>
	<script src="jqC/development-bundle/ui/jquery.ui.sortable.js"></script>
	<script src="jqC/development-bundle/ui/jquery.ui.position.js"></script>
    <script src="Utils.js"></script>
    <script type="text/javascript" src="swfobject.js"></script>
    <link rel="stylesheet" href="jqC/development-bundle/demos/demos.css">
	<style>
		/*#menu, #first, #second { list-style-type: none; margin: 0; padding: 0; float: left;}
		#first li, #second li { margin: 3px 3px 3px 0; padding: 1px; float: left; width: 100px; height: 90px; font-size: 4em; text-align: center; }
		#firstView, #secondView { width: 80%; background-color: red }*/
/*		#firstView, #secondView { overflow: scroll; width: 100%; height: 45%; }*/
		body { height: 100%; }
        .taArea {width: 100%; height: 85%; }
        .auto {width: auto; height: auto;}
		#dTextInput { width: 100%; }
		#iCriteria, #iTitle { width: 100%; }		
		#dMenu { float: left;  width: 100px; height: 100%; }
		#dPLists { position:absolute; float: left; left: 100px; width: 100%; height: 99%; }
		#firstView, #secondView { float: left; width: 50%; height: 100%; }
		.internalFrame { float: left; width: 100%; height: 50%; overflow-x: hidden; overflow-y: scroll; }
/*		#ulFirst div, #ulSecond div { float: left; width: 49%; height: 90px; font-size: 4em; text-align: left;}*/
		#ulFirst .ui-state-default, #ulSecond .ui-state-default { float:left; cursor: default; width: 49.6%; height: 90px;  }
		.image-div { float: left; position: relative; width: 123px; height: 90px; }
		#ulFirst img, #ulSecond img { float: left; height: 90px; }
		.duration-caption { float: right; position: absolute; width: auto; height: auto; background: #000000; color: #FFFFFF; font-family: Arial, Helvetica, sans-serif; font-size: 11px; } 
		#ulFirst span, #ulSecond span { left: 128px; top: 5px; word-break: break-all; font-family: Arial, Helvetica, sans-serif; font-size: 11px; padding-top: 2px; }
	</style>
	<script>

	</script>
</head>
<body>
<div id="dTextInput">
	<input id="iCriteria" value="CDvC3VmaGpY"/>
	<input id="iTitle"/>		
</div>
<div id="dMenu">
	<div id="dMenu">
		<input id="iRelated" type="button" value="Related"/>
		<input id="iStatus"/>
		<input id="iUploadVideo" type="button" value="UploadVideo"/>
	</div>	
</div>
<!-- <div id="dPLists" class="demo"> -->
<div id="dPLists">
	<div id="firstView">
        <div id="taFirst" class="internalFrame">
            <textarea id="taArea" class="taArea">AdData not defined.
                http://youtube.com/watch?v=True watch:1
                http://youtube.com/watch?v=True watch:1
                http://youtube.com/watch?v=wOrfpzPfVXA watch:1
                http://youtube.com/watch?v=qycqF1CWcXg watch:1
                http://youtube.com/watch?v=uRhoWQX2OF8 watch:1
                http://youtube.com/watch?v=zmG8JYiYvgg watch:1
                http://youtube.com/watch?v=OG2eGVt6v2o watch:1
                http://youtube.com/watch?v=4tY3culIYsE watch:1
                http://youtube.com/watch?v=R0x7ZsTioCQ watch:1
                http://youtube.com/watch?v=6zqpDVyCB2Y watch:1
                http://youtube.com/watch?v=w1CHztjRkyc watch:1
                http://youtube.com/watch?v=LUXuiCkoUFc watch:1
                http://youtube.com/watch?v=8jYrr952vbg watch:1
                http://youtube.com/watch?v=KuVcuTYWPHE watch:1
                http://youtube.com/watch?v=QQLsQJF_aRY watch:1
                http://youtube.com/watch?v=Sgk4cIELMHg watch:1
                http://youtube.com/watch?v=IUMhauUDeWQ watch:1
                http://youtube.com/watch?v=7apji-hg5j4 watch:1
                http://youtube.com/watch?v=__video_id__ watch:1
                http://youtube.com/watch?v=__playlist_video_id__ watch:1
                http://youtube.com/watch?v=1;dc_dedup=1;k21=1;k5=3_14_35_59_67_208;kage=26;kar=4;kauth=1;kclt=1;kcr=us;kga=1002;kgender=m;kgg=1;klg=en;ko=y;kr=H;kvz=203;longform=1;tves=1;yt_vrallowed=1;ytcat=24;ytdevice=1;ytexp=907605.906373.910102.900305.922401.920704.912806.927201.922403.925003.913546.913556.916805.920201.901451;ytps=default;ytvt=w;!c=1358;k2=3;k2=14;k2=35;k2=59;k2=67;k2=208;kvlg=en; watch:1
                http://youtube.com/watch?v=qREKP9oijWI </textarea>
            <input id="taAreaButton" type="button" value="Parse Links"/>
        </div>
		<div id="ulFirst" class="connectedSortable internalFrame">
		</div>
	</div>
	
	<div id="secondView">
		<div id="ulSecond" class="connectedSortable">
			<div class="ui-state-default"><div class="duration-caption">12:12:12</div></div>
			<div class="ui-state-default">2</div>
			<div class="ui-state-default">3</div>
			<div class="ui-state-default">4</div>
			<div class="ui-state-default">5</div>
			<div class="ui-state-default">6</div>
		</div>
	</div>

</div>

<script>
    var videoFeeds = new Array()
    var videoElements = new Array()

	$(function() {
		$( "#ulFirst, #ulSecond" ).sortable({
			connectWith: ".connectedSortable", scrollSensitivity: 50, tolerance: 'pointer'
		}).disableSelection();
	});

    var yte = new YoutubePlayer()

    function onYouTubePlayerReady(playerId) {
        ytPlayer = document.getElementById("ytplayer");
        yte.setPlayer(ytPlayer)
        console.log("youtube Ready")
        yte.ytp.addEventListener("onStateChange", "change")
    }

    function change(state) {
        yte.onStateChange(state)
    }

    var playList
    var currSong

    if(window.location.hash) {
        $("#taArea").val(window.location.hash)
    }

    $("#taAreaButton").click(function() {
        var youtube =/((youtu.be\/)|(watch[^ \"\'<>\/\\,]+v=))([^ &\"\'<>\/\\,]+)/g
        var textArea = $("#taArea").val()
        var youtubeLinks = textArea.match(youtube)
        $('#ulFirst').empty()
        console.log("--------------------------------------------")
        youtubeLinks = youtubeLinks.map(function(item) {
            return item.replace(youtube, "$4")
        }).unique()
        loadPlayList(youtubeLinks)
    })

    function loadPlayList(youtubeLinks) {
        var responseCounter = 0
        var playListFinishedLoading = function(playListSize, current) {
            if(playListSize == current) {
                yte.drawPlayer("taFirst")
            }
        }
        youtubeLinks.forEach(function(videoId) {
            var videoElement = new VideoElement(null, "#ulFirst")
            videoElements.push(videoElement)
            $.ajax({
                url: "http://gdata.youtube.com/feeds/api/videos/" + videoId + "?v=2&alt=json",
                success: function(data) {
                    var videoFeed = new VideoFeed(data.entry)
                    this.fillDiv(videoFeed)
                    playListFinishedLoading(youtubeLinks.length, ++responseCounter)
                },
                error: function(data) {
                    playListFinishedLoading(youtubeLinks.length, ++responseCounter)
                },
                context: videoElement
            })
        })
    }

	var i = 0;
	var aSuccess = function(data) {
		// alert('success')
		// $.each(data, function(key, element) {
    	// alert('key: ' + key + '\n' + 'value: ' + element);
		// });
		// alert(data.feed.title.$t)
		// alert(data.data.items[0].id)
		$('#ulFirst').empty();
		$('#iStatus').attr('value', i++)
		$.each(data.data.items, function(index, item) {
            var videoFeed = new VideoFeed(item)
            videoFeeds.push(videoFeed)
            new VideoElement(videoFeed, "#ulFirst")
        });
	}
	var aError = function(data) {
		alert("error")
	}
	$.ajax({
		url : 'https://gdata.youtube.com/feeds/api/videos?v=2&alt=jsonc&start-index=1&max-results=50&q=asking%20alexandria&orderby=relevance',
		// url : 'https://gdata.youtube.com/feeds/api/videos/8_E8x15wkAo/related?v=2&alt=jsonc&max-results=3',
		dataType : 'json',
		success : aSuccess,
		error : aError
	})
</script>

<script>
	var gAuth = "ya29.AHES6ZRJAemB5cj_n1I1H0oqR2d6G-dp814wOAN2Hk77izkPkJHrES8"
	var uploadVideo = function() {
		var feedRequest = '<?xml version="1.0"?><feed xmlns="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/" xmlns:batch="http://schemas.google.com/gdata/batch" xmlns:yt="http://gdata.youtube.com/schemas/2007"><batch:operation type="update"/><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry></feed>'
		$.ajax({
			// url : 'https://gdata.youtube.com/feeds/api/videos?v=2&alt=jsonc&start-index=1&max-results=50&q=asking%20alexandria&orderby=relevance',
			// url : 'https://gdata.youtube.com/feeds/api/videos/' + currId + '/related?v=2&alt=jsonc&max-results=' + maxRes,
			url : 'kladecyt',
			type: 'POST',
			headers: { 'Bearer': gAuth},
			data: feedRequest,
			success : function(){ alert('success')},
			error : aError
		})	
	}

	var batchWrapper = function() {
		setTimeout(batch, "60000")
	}

	var batchI = 0;
	var batch = function() {
		if(batchI < 200 && batchI < songs.length) {
			console.log('batchI ' + batchI)
			console.log('songs.length ' + songs.length)
			var feedStart = '<feed xmlns="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/" xmlns:batch="http://schemas.google.com/gdata/batch" xmlns:yt="http://gdata.youtube.com/schemas/2007"><batch:operation type="update"/>'
			var feedEnd = '</feed>'
			var end = batchI + 40
			for (var i=batchI; i < end && i < songs.length && i < 200; i++, batchI++) {
				var entry = '<entry><batch:operation type="insert"/><id>' + songs[i] + '</id></entry>'
				feedStart += entry
			};
			console.log(feedStart + feedEnd)
			$.ajax({
				// url : 'https://gdata.youtube.com/feeds/api/videos?v=2&alt=jsonc&start-index=1&max-results=50&q=asking%20alexandria&orderby=relevance',
				// url : 'https://gdata.youtube.com/feeds/api/videos/' + currId + '/related?v=2&alt=jsonc&max-results=' + maxRes,
				url : 'kladecyt',
				type: 'POST',
				headers: { 'Bearer': gAuth},
				data: feedStart + feedEnd,
				success : batchWrapper,
				error : aError
			})	
		} else {
			console.log('done with')
			console.log('batchI ' + batchI)
			console.log('songs.length ' + songs.length)
		}	
	}
	
	var related = function(maxRes) {
		if(recDepth > 0) {
			$.each(currIteration, function(index, currId) {
				// console.log('related ' + currIteration.length)
				$.ajax({
					// async: false,
					// url : 'https://gdata.youtube.com/feeds/api/videos?v=2&alt=jsonc&start-index=1&max-results=50&q=asking%20alexandria&orderby=relevance',
					url : 'https://gdata.youtube.com/feeds/api/videos/' + currId + '/related?v=2&alt=jsonc&max-results=' + maxRes,
					// dataType : 'json',
					success : addSongs,
					error : aError
				})				 
			});
		} else {
			console.log(songs.length)
			console.log(songs.unique().length)
			songs = songs.unique()
			batch(0)
		}
	}
	


	var addSongs = function(data) {
		currLength++
		$.each(data.data.items, function(index, item) {
			songs.push(item.id)	
			nextIteration.push(item.id)	
			console.log(item.id)
		})
		// console.log('addSongs ' + currIteration.length)
		if(currLength == currIteration.length) {
			currLength = 0
			console.log('currIteration')
			recDepth--
			currIteration = nextIteration
			nextIteration = []
			related(maxRes)
		}		
	}
	
	var vId = $('#iCriteria').attr('value')
	var maxRes = 15;
	var recDepth = 2;

	var currIteration = []
	var currLength = 0;
	var nextIteration = []
	var songs = new Array()
	
	songs.push(vId)
	currIteration.push(vId)
	$("#iRelated").click(function() {
		related(maxRes)
	});
	
	$("#iUploadVideo").click(function() {
		uploadVideo()		
	});

</script>
</body>
</html>
