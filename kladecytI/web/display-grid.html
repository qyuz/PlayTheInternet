<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Play The Internet</title>
    <LINK REL="SHORTCUT ICON" HREF="favicon.ico" />
    <!--<script src="jqC/development-bundle/jquery-1.7.1.js"></script>-->
    <!--<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.23/jquery-ui.js"></script>-->
    <!--<script src="jqC/development-bundle/ui/jquery.ui.core.js"></script>-->
    <!--<script src="jqC/development-bundle/ui/jquery.ui.widget.js"></script>-->
    <!--<script src="jqC/development-bundle/ui/jquery.ui.mouse.js"></script>-->
    <!--<script src="jqC/development-bundle/ui/jquery.ui.sortable.js"></script>-->
    <!--<script src="jqC/development-bundle/ui/jquery.ui.position.js"></script>-->

    <link rel="stylesheet" href="http://meyerweb.com/eric/tools/css/reset/reset.css">
    <!--<link rel="stylesheet" href="jqC/development-bundle/themes/base/jquery.ui.all.css">-->
    <!--<link rel="stylesheet" href="jqC/development-bundle/demos/demos.css">-->
    <!--<link rel="stylesheet" href="bootstrapCustom/css/bootstrap.css">    -->
    <!--<link rel="stylesheet" href="http://bootswatch.com/cosmo/bootstrap.css">-->
    <link rel="stylesheet" href="bootswatch/cosmo.css">
    <!--<link rel="stylesheet" href="https://raw.github.com/littlesparkvt/flatstrap/master/assets/css/bootstrap.css">-->
    <script src="js/datajs.js"></script>
    <script src="bootstrapCustom/js/bootstrap.js"></script>
    <script src="https://raw.github.com/diy/intercom.js/master/intercom.js"></script>
    <script src="https://raw.github.com/documentcloud/underscore/master/underscore.js"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="jqC/js/jquery-ui-1.10.1.js"></script>
    <script src="SiteHandlers.js"></script>
    <script src="Utils.js"></script>
    <script src="parse.js"></script>
    <script type="text/javascript" src="swfobject.js"></script>
    <script src="https://w.soundcloud.com/player/api.js" type="text/javascript"></script>
    <script src="http://a.vimeocdn.com/js/froogaloop2.min.js" type="text/javascript"></script>
    <script src="jqC/js/jquery.slimscroll.js"></script>
    <link rel="stylesheet" href="playlist.css">
    <style>
        .nav-pills > li > a {
            margin-right: 0px;
            margin-bottom: 0px;
            margin-top: 0px;
            color: #007fff;
        }
        .nav-pills > li > a:focus {
            background-color: #FFFFFF;
        }

        .nav > .active > a, .nav > .active > a > div, .nav > .active > a:hover, .nav > .active > a:hover > div{
            outline:none;
        }

        .nav-pills > .active > a > div, .nav-pills > .active > a:hover > div {
            color: #ffffff;
            background-color: #007fff;
        }

        .nav-pills > li > a:hover, .nav-pills > li > a:hover > div  {
            background-color: #d4fff7;
            color: #007fff;
        }
    </style>
    <script>

    </script>
</head>
<body>
<script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38758747-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

</script>
<div id="dPLists">
    <div id="firstView">
        <div id="tabs" class="playlistFrame">
            <ul style="height: 0px;" class="nav nav-pills">
                <li class="active"><a href="#player">Player<div id="podPlayer" style="position: fixed; z-index: -1; left: 0px; width: 65px;"></div></a></li>
                <li><a href="#tAreaDiv">Text Area<div id="podTa" style="position: fixed; z-index: -1; left: 65px; width: 87px;"></div></a></li>
                <li><a href="#optionsDiv">Options<div id="podOptions" style="position: fixed; z-index: -1; left: 152px; width: 77px;"></div></a></li>
                <li><a href="#recycleBinDiv">Bin<div id="podBin" style="position: fixed; z-index: -1; left: 229px; width: 46px;"></div></a></li>
            </ul>
            <div id="player">
            </div>
            <div id="tAreaDiv">
                <textArea id="tArea" class="taArea"></textArea>
                <br>
                <input id="tAreaParseButton" type="button" value="Parse text and add to playlist"/>
            </div>
            <div id="optionsDiv" class="playlistFrame">
                <fieldset>
                    <legend>Share this link</legend>
                    <input id="buildHash" type="button" value="Build link"/>
                    <br>
                    <input id="buildHashInput" class="max-width" type="text"/>
                </fieldset>
                <fieldset>
                    <legend>Rename window</legend>
                    <input id="renameWindow" type="button" value="Rename window"/>
                    <br>
                    <input id="renameWindowInput" class="max-width" type="text"/>
                </fieldset>
            </div>
            <div id="recycleBinDiv" class="playlistFrame">
                <div id="ulFirst" class="connectedSortable playlistFrame"></div>
            </div>
            <!--<div id="taFirst" class="playlistFrame internalFrame">-->
            <!--</div>-->
            <div id="players" class="playlistFrame">
                <div id="soundCloudContainer" class="playlistFrame" style="width: 0%">
                    <div id="soundCloud">
                        <iframe id="sc-widget"
                                src="https://w.soundcloud.com/player/?url=https://soundcloud.com/timelock/timelock-ace-ventura-inside-us"
                                width="100%" height="465" scrolling="no" frameborder="no">
                        </iframe>
                    </div>
                </div>
                <div id="youtubeContainer" class="playlistFrame" style="width: 0%">
                    <div id="youtube"></div>
                </div>
                <div id="vimeoContainer" class="playlistFrame" style="width: 100%">
                </div>
            </div>
        </div>
    </div>

    <div id="secondView">
        <div id="ulSecond" class="connectedSortable playlistFrame"></div>
    </div>

</div>

<script>

    var playFirstLoaded = _.after(3, function() {
        console.log('playFirstLoaded')
        yte.playVideoDiv(yte.pla.currSong)
    })

var gimpedAnimation = [
    {nav:"#player", fixed:"#podPlayer"},
    {nav:"#tAreaDiv", fixed:"#podTa"},
    {nav:"#optionsDiv", fixed:"#podOptions"},
    {nav:"#recycleBinDiv", fixed:"#podBin"}
]

fc = 220

$.each(gimpedAnimation, function (index, item) {
    var rgb = function (number) {
        console.log(number)
        return 'rgb(' + number + ', ' + number + ', ' + number + ')'
    }
    $('a[href="' + item.nav + '"]').mouseenter(function (event, ui) {
        $(item.fixed).animate({height:"100%"}, { queue:false, duration:500})
    }).mouseleave(function (event, ui) {
                $(item.fixed).animate({
                    height:"0%"
                }, 600, 'linear', function () {
                    $('a[href="' + item.nav + '"]').removeClass('post-hover')
                });
                $(item.fixed).addClass('post-hover')
                $('a[href="' + item.nav + '"]').addClass('post-hover')
            });
})

    $(document).ready(function () {
        $("#ulFirst, #ulSecond").sortable({
//            create: function(event, ui) {
//                var that = this;
//                $('.ui-state-default', that).addClass('pti-state-default');
//            },
            connectWith: '.connectedSortable',
            scrollSensitivity:50,
            tolerance:'pointer',
            distance:25,
            update:function (event, ui) {
                yte.pla.recalculatePlaylist()
            }
        }).disableSelection();
        window.initPlayer = _.once(function (songIds) {
            this.init(songIds)
        })
        $('#tAreaParseButton').click(function() {
            var tAreaText = $('#tArea').val()
            initPlayer(yte.pla.parseSongIds(playTheInternetParse($('#tArea').val())));
            yte.pla.addSongsToPlaylist(yte.pla.parseSongIds(playTheInternetParse(tAreaText)), true)
        })
        $('#buildHash').click(function() {
            $('#buildHashInput').val(window.location.origin + '/display-grid.html'+ yte.pla.buildHash())
        })
        $('#renameWindow').click(function() {
            var renameWindowInputVal = $('#renameWindowInput').val();
            if (renameWindowInputVal.length > 0) {
                document.title = document.title.replace(windowId, renameWindowInputVal)
                windowId = renameWindowInputVal
                IntercomWrapper(windowId)
            }
        })

        IntercomWrapper(windowId)

        if (window.location.hash.length > 0) {
            initPlayer(yte.pla.parseSongIds(window.location.hash));
        } else {
            $( "#tabs" ).tabs( "option", "active", 1 );
        }
        document.title = windowId
    })

    var intercom
    var windowId = GUID()
//    var yt1 = new YoutubePlayer(null, new Playlist("#ulFirst"))
    var yte = new YoutubePlayer(null, new Playlist("#ulSecond"))
    yte.drawPlayer("youtube");
    var init = function (songIds) {
//        yte.pla.addSongsToPlayList("#ulFirst", songIds)
        yte.pla.addSongsToPlaylist(songIds)
    };

//        setSlimScroll('#ulFirst')
    setSlimScroll('#ulSecond', "100%")

    var scWidgetIframe = document.getElementById('sc-widget');
    window.scWidget = SC.Widget(scWidgetIframe);

    scWidget.bind(SC.Widget.Events.READY, function () {
        playFirstLoaded();
        scWidget.bind(SC.Widget.Events.FINISH, function () {
            scWidget.getCurrentSoundIndex(function (data) {
                scWidget.getSounds(function (sounds) {
                    console.log('finished sounds count: ' + sounds.length + ' and current index: ' + data)
                    if (data == sounds.length - 1) {
                        SiteHandlerManager.prototype.stateChange("NEXT")
                    }
                })
            })
        })
    });

    function onYouTubePlayerReady(playerId) {
        ytPlayer = document.getElementById("ytplayer");
        yte.setPlayer(ytPlayer)
        console.log("youtube Ready")
        yte.ytp.addEventListener("onStateChange", "change")
        yte.ytp.addEventListener("onError", "onError")
        $('#ulFirst, #ulSecond').click(function(evt) {
            yte.playVideoDiv($(evt.target).closest('div[class="pti-state-default"]'))
        })
        $(window).resize(function() {
            var ytp = $(ytPlayer)
            ytp.height(ytp.width() / 1.642)
            console.log(ytp.height())
        })
        playFirstLoaded();
    }

    function change(state) {
        if(state == 0) {
            SiteHandlerManager.prototype.stateChange("NEXT")
        }
    }

    function onError() {
        SiteHandlerManager.prototype.stateChange("ERROR")
    }

</script>

<script>
    var uploadVideo = function() {
        var feedRequest = '<?xml version="1.0"?><feed xmlns="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/" xmlns:batch="http://schemas.google.com/gdata/batch" xmlns:yt="http://gdata.youtube.com/schemas/2007"><batch:operation type="update"/><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry><entry><batch:operation type="insert"/><id>sCKe65D-uyo</id></entry></feed>'
        $.ajax({
            // url : 'https://gdata.youtube.com/feeds/api/videos?v=2&alt=jsonc&start-index=1&max-results=50&q=asking%20alexandria&orderby=relevance',
            // url : 'https://gdata.youtube.com/feeds/api/videos/' + currId + '/related?v=2&alt=jsonc&max-results=' + maxRes,
            url : 'kladecyt',
            type: 'POST',
            headers: { 'Bearer': gAuth},
            data: feedRequest,
            success : function(){ alert('success')},
            error : aError
        })
    }

    var batchWrapper = function() {
        setTimeout(batch, "60000")
    }

    var batchI = 0;
    var batch = function() {
        if(batchI < 200 && batchI < songs.length) {
            console.log('batchI ' + batchI)
            console.log('songs.length ' + songs.length)
            var feedStart = '<feed xmlns="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/" xmlns:batch="http://schemas.google.com/gdata/batch" xmlns:yt="http://gdata.youtube.com/schemas/2007"><batch:operation type="update"/>'
            var feedEnd = '</feed>'
            var end = batchI + 40
            for (var i=batchI; i < end && i < songs.length && i < 200; i++, batchI++) {
                var entry = '<entry><batch:operation type="insert"/><id>' + songs[i] + '</id></entry>'
                feedStart += entry
            };
            console.log(feedStart + feedEnd)
            $.ajax({
                // url : 'https://gdata.youtube.com/feeds/api/videos?v=2&alt=jsonc&start-index=1&max-results=50&q=asking%20alexandria&orderby=relevance',
                // url : 'https://gdata.youtube.com/feeds/api/videos/' + currId + '/related?v=2&alt=jsonc&max-results=' + maxRes,
                url : 'kladecyt',
                type: 'POST',
                headers: { 'Bearer': gAuth},
                data: feedStart + feedEnd,
                success : batchWrapper,
                error : aError
            })
        } else {
            console.log('done with')
            console.log('batchI ' + batchI)
            console.log('songs.length ' + songs.length)
        }
    }

    var related = function(maxRes) {
        if(recDepth > 0) {
            $.each(currIteration, function(index, currId) {
                // console.log('related ' + currIteration.length)
                $.ajax({
                    // async: false,
                    // url : 'https://gdata.youtube.com/feeds/api/videos?v=2&alt=jsonc&start-index=1&max-results=50&q=asking%20alexandria&orderby=relevance',
                    url : 'https://gdata.youtube.com/feeds/api/videos/' + currId + '/related?v=2&alt=jsonc&max-results=' + maxRes,
                    // dataType : 'json',
                    success : addSongs,
                    error : aError
                })
            });
        } else {
            console.log(songs.length)
            console.log(songs.unique().length)
            songs = songs.unique()
            batch(0)
        }
    }



    var addSongs = function(data) {
        currLength++
        $.each(data.data.items, function(index, item) {
            songs.push(item.id)
            nextIteration.push(item.id)
            console.log(item.id)
        })
        // console.log('addSongs ' + currIteration.length)
        if(currLength == currIteration.length) {
            currLength = 0
            console.log('currIteration')
            recDepth--
            currIteration = nextIteration
            nextIteration = []
            related(maxRes)
        }
    }

    var vId = $('#iCriteria').attr('value')
    var maxRes = 15;
    var recDepth = 2;

    var currIteration = []
    var currLength = 0;
    var nextIteration = []
    var songs = new Array()

    songs.push(vId)
    currIteration.push(vId)
    $("#iRelated").click(function() {
        related(maxRes)
    });

    $("#iUploadVideo").click(function() {
        uploadVideo()
    });

    $('#tabs').tabs({
        activate: function( event, ui ) {
            var newTab = $(ui.newTab);
            console.log(newTab)
            newTab.addClass('active')
            $(ui.oldTab).removeClass('active')
        }
    })
</script>
</body>
</html>
