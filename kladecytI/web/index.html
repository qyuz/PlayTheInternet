<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- The HTML 4.01 Transitional DOCTYPE declaration-->
<!-- above set at the top of the file will set     -->
<!-- the browser's rendering engine into           -->
<!-- "Quirks Mode". Replacing this declaration     -->
<!-- with a "Standards Mode" doctype is supported, -->
<!-- but may lead to some differences in layout.   -->

<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <script src="jqC/development-bundle/jquery-1.7.1.js"></script>
    <title>Hello App Engine</title>
  </head>

  <body>
    <h1>Hello App Engine!</h1>
	
    <table>
      <tr>
        <td colspan="2" style="font-weight:bold;">Available Servlets:</td>        
      </tr>
      <tr>
          <a id="local">LOCAL</a>
          <br>
          <a id="production">PlayTheInternet</a>

          <a id="holder" style="visibility: hidden;" href="javascript: (function () {
    function playTheInternetParse() {
        document.getHTML = function (who, deep) {
            if (!who || !who.tagName) return '';
            var txt, el = document.createElement('div');
            el.appendChild(who.cloneNode(deep));
            txt = el.innerHTML;
            el = null;
            return txt;
        };
        Array.prototype.unique = function (a) {
            return function () {
                return this.filter(a)
            }
        }(function (a, b, c) {
            return c.indexOf(a) == b
        });
        var html = document.getElementsByTagName('html')[0];
        var htmlText = document.getHTML(html, true);
        var youtube = /(youtu.be\/|watch[^ \'\'<>]+v=|youtube.com\/embed\/|youtube.com\/v\/)([^ &\'\'<>\/\\.]{11})/g;
        var youtubeLinks = htmlText.match(youtube);
        var uTubeLinks = youtubeLinks.unique();
        var result = '';
        for (var i = 0; i < uTubeLinks.length; i++) {
            result += 'http://youtube.com/watch?v=' + uTubeLinks[i].replace(youtube, '$2') + ',';
        }
        return result;
    }
    if (typeof (playTheInternetParse) == 'undefined') {
        console.log('first time');
        var parse = document.createElement('script');
        parse.src = 'DOMAIN/parse.js';
        document.getElementsByTagName('head')[0].appendChild(parse);
    }
    function parsePage() {
        setTimeout(function () {
            if (typeof (playTheInternetParse) != 'undefined') {
                openWindow(playTheInternetParse());
            } else {
                console.log('undefined');
                parsePage();
            }
        }, 0)
    }
    function openWindow(links) {
        var a = window,
            b = document,
            c = encodeURIComponent,
            d = a.open('DOMAIN/parse.html#' + links, 'bkmk_popup', 'left=' + ((a.screenX || a.screenLeft) + 10) + ',top=' + ((a.screenY || a.screenTop) + 10) + ',height=300px,width=750px,resizable=1,alwaysRaised=1');
        a.setTimeout(function () {
            d.focus();
        }, 300)
    }
    parsePage();
})();">HOLDER</a>

      </tr>
    </table>
    <script>
        $('#local').attr('href', $('#holder').attr('href').replace(/DOMAIN/g, 'http://localhost:8888'))
        $('#production').attr('href', $('#holder').attr('href').replace(/DOMAIN/g, 'http://playtheinternet.appspot.com'))
    </script>
  </body>
</html>
